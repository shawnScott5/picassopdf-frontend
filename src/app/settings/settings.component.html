<div class="settings-container">
  <div class="header">
    <div class="title-section">
      <h1>Settings</h1>
      <p>Manage your PicassoPDF account and preferences</p>
    </div>
  </div>

  <div class="settings-content">
    <!-- Settings Navigation -->
    <div class="settings-nav">
      <button 
        class="nav-tab" 
        [class.active]="activeTab === 'profile'"
        (click)="setActiveTab('profile')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
        Profile
      </button>
      
      <button 
        class="nav-tab" 
        [class.active]="activeTab === 'company'"
        (click)="setActiveTab('company')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
        Company
      </button>
      
      <button 
        class="nav-tab" 
        [class.active]="activeTab === 'api'"
        (click)="setActiveTab('api')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="16,18 22,12 16,6"></polyline>
          <polyline points="8,6 2,12 8,18"></polyline>
        </svg>
        API Settings
      </button>
      
      <button 
        class="nav-tab" 
        [class.active]="activeTab === 'billing'"
        (click)="setActiveTab('billing')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
          <line x1="1" y1="10" x2="23" y2="10"></line>
        </svg>
        Billing
      </button>
    </div>

    <!-- Settings Panels -->
    <div class="settings-panels">
      
      <!-- Profile Settings -->
      <div *ngIf="activeTab === 'profile'" class="settings-panel">
        <div class="panel-header">
          <h2>Profile Information</h2>
          <p>Update your personal information and account details</p>
        </div>
        
        <div class="panel-content">
          <div class="form-grid">
            <div class="form-group">
              <label for="firstName">First Name</label>
              <input type="text" id="firstName" [(ngModel)]="profileForm.firstName" placeholder="Enter your first name">
            </div>
            
            <div class="form-group">
              <label for="lastName">Last Name</label>
              <input type="text" id="lastName" [(ngModel)]="profileForm.lastName" placeholder="Enter your last name">
            </div>
            
            <div class="form-group">
              <label for="email">Email Address</label>
              <input type="email" id="email" [(ngModel)]="profileForm.email" placeholder="Enter your email">
            </div>
            
            <div class="form-group">
              <label for="company">Company</label>
              <input type="text" id="company" [(ngModel)]="profileForm.company" placeholder="No company associated" readonly>
            </div>
          </div>
          
          <!-- Reset Password Section -->
          <div class="reset-password-section">
            <h3>Change Password</h3>
            <p>Update your account password for better security</p>
            
            <div class="password-form">
              <div class="form-group">
                <label for="newPassword">New Password</label>
                <input type="password" id="newPassword" [(ngModel)]="passwordForm.newPassword" placeholder="Enter your new password">
              </div>
              
              <div class="form-group">
                <label for="confirmPassword">Confirm New Password</label>
                <input type="password" id="confirmPassword" [(ngModel)]="passwordForm.confirmPassword" placeholder="Confirm your new password">
              </div>
              
              <div class="password-actions">
                <button class="btn btn-primary" (click)="changePassword()">Change Password</button>
              </div>
            </div>
          </div>
          
          <div class="panel-actions">
            <button class="btn btn-primary" (click)="updateProfile()">Save Changes</button>
          </div>
        </div>
      </div>

      <!-- API Settings -->
      <div *ngIf="activeTab === 'api'" class="settings-panel">
        <div class="panel-header">
          <h2>API Configuration</h2>
          <p>Configure your webhook endpoint</p>
        </div>
        
        <div class="panel-content">
          <div class="form-grid">
            <div class="form-group">
              <label for="webhookUrl">Webhook URL</label>
              <input type="url" id="webhookUrl" [(ngModel)]="apiSettings.webhookUrl" placeholder="https://your-domain.com/webhook">
              <small>Receive notifications when conversions are completed</small>
            </div>
          </div>
          
          <div class="panel-actions">
            <button class="btn btn-primary" (click)="saveApiSettings()">Save API Settings</button>
          </div>
        </div>
      </div>

      <!-- Email Settings -->
      <div *ngIf="activeTab === 'email'" class="settings-panel">
        <div class="panel-header">
          <h2>Email Settings</h2>
          <p>Configure your email preferences and notifications</p>
        </div>
        
        <div class="panel-content">
          <div class="form-grid">
            <div class="form-group">
              <label for="senderName">Sender Name</label>
              <input type="text" id="senderName" [(ngModel)]="emailSettings.senderName" placeholder="Your name">
            </div>
            
            <div class="form-group">
              <label for="senderEmail">Sender Email</label>
              <input type="email" id="senderEmail" [(ngModel)]="emailSettings.senderEmail" placeholder="noreply@yourdomain.com">
            </div>
            
            <div class="form-group">
              <label for="replyToEmail">Reply-To Email</label>
              <input type="email" id="replyToEmail" [(ngModel)]="emailSettings.replyToEmail" placeholder="support@yourdomain.com">
            </div>
            
            <div class="form-group full-width">
              <label for="emailSignature">Email Signature</label>
              <textarea id="emailSignature" [(ngModel)]="emailSettings.emailSignature" rows="4" placeholder="Add your email signature here..."></textarea>
            </div>
          </div>
          
          <div class="panel-actions">
            <button class="btn btn-primary" (click)="saveEmailSettings()">Save Email Settings</button>
          </div>
        </div>
      </div>

      <!-- Notification Settings -->
      <div *ngIf="activeTab === 'notifications'" class="settings-panel">
        <div class="panel-header">
          <h2>Notification Preferences</h2>
          <p>Choose what notifications you want to receive</p>
        </div>
        
        <div class="panel-content">
          <div class="notification-settings">
            <div class="notification-item">
              <div class="notification-info">
                <h3>Email Notifications</h3>
                <p>Receive important updates via email</p>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" [(ngModel)]="notificationSettings.emailNotifications">
                <span class="slider"></span>
              </label>
            </div>
            
            <div class="notification-item">
              <div class="notification-info">
                <h3>Conversion Alerts</h3>
                <p>Get notified when conversions are completed</p>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" [(ngModel)]="notificationSettings.conversionAlerts">
                <span class="slider"></span>
              </label>
            </div>
            
            <div class="notification-item">
              <div class="notification-info">
                <h3>Usage Reports</h3>
                <p>Weekly reports on your API usage</p>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" [(ngModel)]="notificationSettings.usageReports">
                <span class="slider"></span>
              </label>
            </div>
            
            <div class="notification-item">
              <div class="notification-info">
                <h3>System Updates</h3>
                <p>Important platform updates and maintenance</p>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" [(ngModel)]="notificationSettings.systemUpdates">
                <span class="slider"></span>
              </label>
            </div>
            
            <div class="notification-item">
              <div class="notification-info">
                <h3>Credit Alerts</h3>
                <p>Notifications when credits are running low</p>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" [(ngModel)]="notificationSettings.creditAlerts">
                <span class="slider"></span>
              </label>
            </div>
          </div>
          
          <div class="panel-actions">
            <button class="btn btn-primary" (click)="saveNotificationSettings()">Save Notification Settings</button>
          </div>
        </div>
      </div>



      <!-- Company Management -->
      <div *ngIf="activeTab === 'company'" class="settings-panel">
        <div class="panel-header">
          <h2>Company Management</h2>
          <p>Manage your company team members and invitations</p>
        </div>
        
        <div class="panel-content">
          <!-- Company Management Section - Always show the table -->
          <div class="company-vault-container">
            <div class="content-wrapper">
              <div class="content">
                <!-- Users Table -->
                <div class="users-table-container">
                  <div class="table-header">
                    <h3>Your Team Members</h3>
                    <div class="table-actions">
                      <input type="text" placeholder="Search users..." class="search-input" [(ngModel)]="userSearchTerm" (input)="onUserSearchChange()">
                      <button class="btn btn-primary" (click)="openAddUserModal()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <line x1="12" y1="5" x2="12" y2="19"></line>
                          <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Add User
                      </button>
                    </div>
                  </div>

                  <div class="table-wrapper">
                    <table class="users-table">
                      <thead>
                        <tr>
                          <th>Name</th>
                          <th>Email</th>
                          <th>Role</th>
                          <th>Status</th>
                          <th>Joined</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let member of filteredUsers" class="user-row">
                          <td class="user-name">
                            <div class="user-info">
                              <div class="user-avatar">
                                {{ member.name?.charAt(0)?.toUpperCase() || 'U' }}
                              </div>
                              <div>
                                <div class="user-title">{{ member.name || 'Unknown' }}</div>
                              </div>
                            </div>
                          </td>
                          <td class="user-email">{{ member.email }}</td>
                          <td class="user-role">
                            <span class="role-badge" [ngClass]="'role-' + member.role">
                              {{ member.role || 'member' }}
                            </span>
                          </td>
                          <td class="user-status">
                            <span class="status-badge" [ngClass]="'status-' + (member.status || 'active')">
                              {{ member.status || 'active' }}
                            </span>
                          </td>
                          <td class="user-date">{{ member.joinedAt | date:'MMM dd, yyyy' }}</td>
                          <td class="user-actions">
                            <button class="btn btn-sm btn-outline-primary" 
                                    (click)="editUserPermissions(member)" 
                                    matTooltip="Edit Permissions" 
                                    matTooltipClass="nav-tooltip">
                              <i class="fas fa-edit" style="font-family: 'Font Awesome 6 Free'; font-weight: 900;"></i>
                            </button>
                            <button *ngIf="member.role !== 'owner'"
                                    class="btn btn-sm btn-danger" 
                                    (click)="deleteUser(member)" 
                                    matTooltip="Remove User" 
                                    matTooltipClass="nav-tooltip">
                              <i class="fas fa-trash" style="font-family: 'Font Awesome 6 Free'; font-weight: 900;"></i>
                            </button>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                    
                    <div class="empty-state" *ngIf="filteredUsers.length === 0">
                      <div class="empty-content">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                          <circle cx="9" cy="7" r="4"></circle>
                          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        <h4>No team members found</h4>
                        <p>Start building your team by inviting your first user.</p>
                        <button class="btn btn-primary" (click)="openAddUserModal()">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                          </svg>
                          Add Your First User
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>


      <!-- Billing Settings -->
      <div *ngIf="activeTab === 'billing'" class="settings-panel">
        <div class="panel-header">
          <h2>Billing & Subscription</h2>
          <p>Manage your subscription and billing information</p>
        </div>
        
        <div class="panel-content">
          <div class="billing-info">
            <div class="billing-item">
              <div class="billing-label">Current Plan</div>
              <div class="billing-value">{{ billingSettings.currentPlan }}</div>
            </div>
            
            <!-- <div class="billing-item payment-method">
              <div class="billing-label">Payment Method</div>
              <div class="billing-value">{{ billingSettings.paymentMethod }}</div>
              <button class="btn btn-secondary" (click)="openPaymentMethodModal()">Update</button>
            </div> -->
            
            <div class="billing-item">
              <div class="billing-label">Next Billing Date</div>
              <div class="billing-value">{{ billingSettings.nextBillingDate || 'N/A' }}</div>
            </div>
            
            <div class="billing-item">
              <div class="billing-label">Billing Email</div>
              <div class="billing-value">{{ billingSettings.billingEmail || user?.email }}</div>
            </div>
          </div>
          
        </div>
             </div>
     </div>
   </div>
 </div>

<!-- Add User Modal -->
<div *ngIf="showAddUserModal" class="modal-overlay" (click)="closeAddUserModal()">
  <div class="modal-content add-user-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ editingUser ? 'Edit Team Member' : 'Add Team Member' }}</h3>
      <button class="modal-close" (click)="closeAddUserModal()">
        <i class="fas fa-times" style="font-family: 'Font Awesome 6 Free'; font-weight: 900;"></i>
      </button>
    </div>
    <div class="modal-body">
      <form class="add-user-form" (ngSubmit)="saveUser()" #userForm="ngForm">
        <div class="form-group">
          <label for="fullName">Full Name *</label>
          <input 
            type="text" 
            id="fullName" 
            name="fullName"
            [(ngModel)]="newUserForm.fullName" 
            placeholder="Enter full name"
            required
            class="form-control">
        </div>
        
        <div class="form-group">
          <label for="email">Email Address *</label>
          <input 
            type="email" 
            id="email" 
            name="email"
            [(ngModel)]="newUserForm.email" 
            placeholder="Enter email address"
            required
            class="form-control">
        </div>
        
        <div class="form-group">
          <label for="role">Role *</label>
          <select 
            id="role" 
            name="role"
            [(ngModel)]="newUserForm.role" 
            required
            class="form-control">
            <option value="">Select a role</option>
            <option value="member">Member</option>
            <option value="owner">Owner</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Permissions</label>
          <div class="permissions-section">
            <div *ngFor="let permission of availablePermissions" class="permission-checkbox-item">
              <label class="permission-label">
                <input 
                  type="checkbox" 
                  [value]="permission.id"
                  [checked]="newUserForm.permissions.includes(permission.id)"
                  (change)="togglePermission(permission.id)"
                  class="permission-checkbox">
                <span class="permission-text">{{ permission.name }}</span>
              </label>
            </div>
          </div>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline-secondary" (click)="closeAddUserModal()">
        Cancel
      </button>
      <button 
        class="btn btn-primary" 
        (click)="saveUser()" 
        [disabled]="isInvitingUser || !userForm.form.valid">
        <i *ngIf="isInvitingUser" class="fas fa-spinner fa-spin" style="font-family: 'Font Awesome 6 Free'; font-weight: 900;"></i>
        <span *ngIf="!isInvitingUser">{{ editingUser ? 'Update User' : 'Add User' }}</span>
        <span *ngIf="isInvitingUser">{{ editingUser ? 'Updating' : 'Adding' }}</span>
      </button>
    </div>
  </div>
</div>

<!-- Payment Method Update Modal -->
<div *ngIf="showPaymentMethodModal" class="modal-overlay" (click)="closePaymentMethodModal()">
  <div class="modal-content payment-method-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Update Payment Method</h3>
      <button class="modal-close" (click)="closePaymentMethodModal()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    
    <div class="modal-body">
      <form class="payment-method-form" [formGroup]="paymentMethodForm" (ngSubmit)="updatePaymentMethod()">
        <div class="form-group">
          <label for="cardNumber">Card Number</label>
          <div class="card-input-wrapper">
            <input 
              type="text" 
              id="cardNumber" 
              formControlName="cardNumber"
              placeholder="1234 5678 9012 3456"
              maxlength="19"
              (input)="formatCardNumber($event)"
              [class.is-invalid]="paymentMethodForm.get('cardNumber')?.invalid && paymentMethodForm.get('cardNumber')?.touched">
            <div class="card-icon">
              <svg width="24" height="16" viewBox="0 0 24 16" fill="none">
                <rect x="0.5" y="1" width="23" height="14" rx="2" ry="2" fill="#1a1a1a"/>
                <rect x="2" y="4" width="20" height="2" rx="1" fill="#fff"/>
                <rect x="2" y="8" width="8" height="2" rx="1" fill="#fff"/>
                <rect x="12" y="8" width="4" height="2" rx="1" fill="#fff"/>
                <rect x="18" y="8" width="4" height="2" rx="1" fill="#fff"/>
              </svg>
            </div>
          </div>
          <div class="error-message" *ngIf="paymentMethodForm.get('cardNumber')?.invalid && paymentMethodForm.get('cardNumber')?.touched">
            Please enter a valid card number
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="expiryDate">Expiry Date</label>
            <input 
              type="text" 
              id="expiryDate" 
              formControlName="expiryDate"
              placeholder="MM/YY"
              maxlength="5"
              (input)="formatExpiryDate($event)"
              [class.is-invalid]="paymentMethodForm.get('expiryDate')?.invalid && paymentMethodForm.get('expiryDate')?.touched">
            <div class="error-message" *ngIf="paymentMethodForm.get('expiryDate')?.invalid && paymentMethodForm.get('expiryDate')?.touched">
              Please enter a valid expiry date
            </div>
          </div>

          <div class="form-group">
            <label for="cvv">CVV</label>
            <input 
              type="text" 
              id="cvv" 
              formControlName="cvv"
              placeholder="123"
              maxlength="4"
              (input)="formatCVV($event)"
              [class.is-invalid]="paymentMethodForm.get('cvv')?.invalid && paymentMethodForm.get('cvv')?.touched">
            <div class="error-message" *ngIf="paymentMethodForm.get('cvv')?.invalid && paymentMethodForm.get('cvv')?.touched">
              Please enter a valid CVV
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="cardholderName">Cardholder Name</label>
          <input 
            type="text" 
            id="cardholderName" 
            formControlName="cardholderName"
            placeholder="John Doe"
            [class.is-invalid]="paymentMethodForm.get('cardholderName')?.invalid && paymentMethodForm.get('cardholderName')?.touched">
          <div class="error-message" *ngIf="paymentMethodForm.get('cardholderName')?.invalid && paymentMethodForm.get('cardholderName')?.touched">
            Please enter the cardholder name
          </div>
        </div>

        <div class="form-group">
          <label for="billingAddress">Billing Address</label>
          <input 
            type="text" 
            id="billingAddress" 
            formControlName="billingAddress"
            placeholder="123 Main Street, City, State 12345"
            [class.is-invalid]="paymentMethodForm.get('billingAddress')?.invalid && paymentMethodForm.get('billingAddress')?.touched">
          <div class="error-message" *ngIf="paymentMethodForm.get('billingAddress')?.invalid && paymentMethodForm.get('billingAddress')?.touched">
            Please enter your billing address
          </div>
        </div>

        <div class="security-notice">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            <path d="M9 12l2 2 4-4"></path>
          </svg>
          <span>Your payment information is encrypted and secure</span>
        </div>
      </form>
    </div>
    
    <div class="modal-footer">
      <button type="button" class="btn btn-outline-secondary" (click)="closePaymentMethodModal()">
        Cancel
      </button>
      <button 
        type="button" 
        class="btn btn-primary" 
        (click)="updatePaymentMethod()"
        [disabled]="paymentMethodForm.invalid || isUpdatingPaymentMethod">
        <div *ngIf="isUpdatingPaymentMethod" class="spinner"></div>
        <span *ngIf="!isUpdatingPaymentMethod">Update Payment Method</span>
        <span *ngIf="isUpdatingPaymentMethod">Updating</span>
      </button>
    </div>
  </div>
</div>